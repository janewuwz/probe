var probe=function(){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function e(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function h(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(t){console.log(t)}function p(){var t=window&&window.screen;return{width:t.width,height:t.height}}(new Date).getTime();var s=function(){function r(){i(this,r);var t=p(),e=t.width,n=t.height;this.w=e,this.h=n,this.watchReqErr()}return e(r,[{key:"watchReqErr",value:function(){this.proxyFetch(),this.proxyAjax()}},{key:"watchJsErr",value:function(t){if(t.srcElement===window&&!/^script error/i.test(t.message)){var e=t.message;t.error&&t.error.stack&&(e=this.processStackMsg(t.error)),this.isOBJByType(e,"Event")&&(e+=e.type?"--"+e.type+"--"+(e.target?e.target.tagName+"::"+e.target.src:""):""),a({stack:e,file:t.filename,rn:t.lineno,cn:t.colno,msg:t.message,w:this.w,h:this.h,type:1})}}},{key:"proxyAjax",value:function(){if(window.XMLHttpRequest){var t=window.XMLHttpRequest,n=function(t){t&&t.currentTarget&&200!==t.currentTarget.status&&a({url:t.currentTarget.responseURL,code:t.currentTarget.status,res:t.target.response,statusText:t.target.statusText,type:2})},r=t.prototype.send;t.prototype.send=function(){if(this.addEventListener)this.addEventListener("error",n),this.addEventListener("load",n),this.addEventListener("abort",n);else{var e=this.onreadystatechange;this.onreadystatechange=function(t){4===this.readyState&&n(t),e&&e.apply(this,arguments)}}return r.apply(this,arguments)}}}},{key:"unhandledRej",value:function(t){t&&a({type:3,msg:t.reason})}},{key:"proxyFetch",value:function(){if(window.fetch){var t=window.fetch;window.fetch=function(){return t.apply(this,arguments).then(function(t){return t.ok||a({url:t.url,res:JSON.stringify(t.body),code:t.status,statusText:t.statusText,type:2}),t}).catch(function(t){throw t})}}}},{key:"processStackMsg",value:function(t){var e=t.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),n=t.toString();return e.indexOf(n)<0&&(e=n+"@"+e),e}},{key:"isOBJByType",value:function(t,e){return Object.prototype.toString.call(t)==="[object "+(e||"Object")+"]"}}]),r}(),g={firstPaint:0,firstMeaningfulPaint:0,tcp:0,dns:0,timeToFirstRequest:0,domInteractive:0,timeToFirstByte:0,frontEndTime:0,complete:0,domTime:0,srcTime:0},c=function(){function t(){i(this,t),this.done=!1,this.isFull=!0,this.clientType="",this.isSupport=!0,this.deadline=0}return e(t,[{key:"perfMonitor",value:function(){var r=this;this.deadline=performance.timing.navigationStart+6e4;try{this.perfObserver=new PerformanceObserver(function(t){t.getEntries().forEach(function(t){var e=t.startTime,n=(t.duration,t.entryType);"first-paint"===t.name&&(g.firstPaint=e),"first-contentful-paint"===t.name&&(g.firstMeaningfulPaing=e),"navigation"===n&&(r.done||r.getResult())})}).observe({entryTypes:["paint","navigation"]})}catch(t){return void(this.isSupport=!1)}}},{key:"getFirstScreenImg",value:function(){try{var t=performance.getEntriesByType("resource"),r=function(){var t=document.getElementsByTagName("*"),n=["META","HEAD","HTML","SCRIPT","STYLE"];t=h(t).filter(function(t){var e=t.tagName;return!n.includes(e)});for(var e,r,i=[],o=0;o<t.length;o++){var a=t[o],s=(r=void 0,e=a.getBoundingClientRect(),r=!1,r=!((r={top:Math.max(e.top,0),left:Math.max(e.left,0),bottom:Math.min(e.bottom,window.innerHeight||document.documentElement.clientHeight),right:Math.min(e.right,window.innerWidth||document.documentElement.clientWidth)}).bottom<=r.top||r.right<=r.left)&&(r.bottom-r.top)*(r.right-r.left));if(s){var c=window.getComputedStyle(a);"IMG"===a.tagName&&i.push(a.src);var u=c&&(c["background-image"]||c.background);if(u){var d=u.match(/http[^'"\)]+/g);if(d&&0<d.length){var f=d[0];i.push(f)}}"IFRAME"===a.tagName&&s&&i.push(a.src)}}return i}();t.forEach(function(t){t.initiatorType;var e=t.responseEnd,n=t.name;r.includes(n)&&e>g.firstMeaningfulPaint&&(g.firstMeaningfulPaint=e)})}catch(t){return void(this.isSupport=!1)}}},{key:"afterOnLoad",value:function(){this.getFirstScreenImg()}},{key:"clearListener",value:function(){window.removeEventListener("load",this.afterOnLoad)}},{key:"disconnect",value:function(t){try{t&&t.disconnect()}catch(t){}}},{key:"getResult",value:function(){this.getMetrics(),this.disconnect(this.perfObserver),this.clearListener()}},{key:"getMetrics",value:function(){var t=performance.timing,e=t.domComplete,n=t.connectStart,r=t.domLoading,i=t.domainLookupStart,o=t.responseEnd,a=t.requestStart,s=t.loadEventEnd,c=t.domInteractive,u=t.navigationStart,d=t.responseStart,f=t.domContentLoadedEventEnd;if(0===s&&+new Date<this.deadline)this.waitUntilEnd();else{g.tcp=n-u,g.dns=i-u,g.timeToFirstRequest=a-u,g.complete=s-u,g.domInteractive=c-u,g.timeToFirstByte=d-a,g.frontEndTime=s-o,g.domTime=f-r,g.srcTime=e-c;var h=p(),l=h.width,m=h.height;g.resolutionWidth=l,g.resolutionHeight=m,this.formatMetrics(g),this.done=!0}}},{key:"waitUntilEnd",value:function(){var t=+new Date<this.deadline;0===performance.timing.loadEventEnd||t?this.timer=setTimeout(this.waitUntilEnd.bind(this),300):(clearTimeout(this.timer),t||this.done||this.getResult())}},{key:"formatMetrics",value:function(){for(var t in 0===g.firstPaint&&this.isSupport&&(g.firstPaint=performance.timing.domLoading-performance.timing.navigationStart),g.firstMeaningfulPaint<=g.firstPaint&&(g.firstMeaningfulPaint=g.firstPaint),g)if("page"!==t){if(g[t]<0)return;g[t]=Math.round(g[t])}this.isFull||(g.isFinish=0),g.type="perf",a(g)}}]),t}();return{setConfig:function(t){if(!(Math.random()>t)){navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);var e=new s,n=new c;n.perfMonitor(),window.addEventListener("load",n.afterOnLoad.bind(n)),window.addEventListener("error",function(t){return e.watchJsErr(t)}),window.addEventListener("unhandledrejection",function(t){return e.unhandledRej(t)}),document.addEventListener("unload",function(t){window.removeEventListener("error")})}}}}();
